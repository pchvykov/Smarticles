<html>
<body>
<script src="resources/eml_report_loadable_data.js"></script>
<pre class="code">
<span class="srcline"><span class="lineno"><a href="68,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S2T69U3">out</span> = lineSegmentIntersect(<span class="var type1" id="S3T71U6">XY1</span>,<span class="var type1" id="S4T71U7">XY2</span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,2" id="srcline2">  2</a></span><span class="line">    <span class="var type1" id="S5T6U8">parThresh</span>,<span class="var type1" id="S6T6U9">distThresh</span>,<span class="var type1" id="S7T59U10">lenMx</span>) <span class="comment">%#codegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,3" id="srcline3">  3</a></span><span class="line"><span class="comment">%LINESEGMENTINTERSECT Intersections of line segments.</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,4" id="srcline4">  4</a></span><span class="line"><span class="comment">%   OUT = LINESEGMENTINTERSECT(XY1,XY2) finds the 2D Cartesian Coordinates of</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,5" id="srcline5">  5</a></span><span class="line"><span class="comment">%   intersection points between the set of line segments given in XY1 and XY2.</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,6" id="srcline6">  6</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,7" id="srcline7">  7</a></span><span class="line"><span class="comment">%   XY1 and XY2 are N1x4 and N2x4 matrices. Rows correspond to line segments. </span></span></span>
<span class="srcline"><span class="lineno"><a href="68,8" id="srcline8">  8</a></span><span class="line"><span class="comment">%   Each row is of the form [x1 y1 x2 y2] where (x1,y1) is the start point and </span></span></span>
<span class="srcline"><span class="lineno"><a href="68,9" id="srcline9">  9</a></span><span class="line"><span class="comment">%   (x2,y2) is the end point of a line segment:</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,10" id="srcline10"> 10</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,11" id="srcline11"> 11</a></span><span class="line"><span class="comment">%                  Line Segment</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,12" id="srcline12"> 12</a></span><span class="line"><span class="comment">%       o--------------------------------o</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,13" id="srcline13"> 13</a></span><span class="line"><span class="comment">%       ^                                ^</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,14" id="srcline14"> 14</a></span><span class="line"><span class="comment">%    (x1,y1)                          (x2,y2)</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,15" id="srcline15"> 15</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,16" id="srcline16"> 16</a></span><span class="line"><span class="comment">%   OUT is a structure with fields:</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,17" id="srcline17"> 17</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,18" id="srcline18"> 18</a></span><span class="line"><span class="comment">%   'intAdjacencyMatrix' : N1xN2 indicator matrix where the entry (i,j) is 1 if</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,19" id="srcline19"> 19</a></span><span class="line"><span class="comment">%       line segments XY1(i,:) and XY2(j,:) intersect.</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,20" id="srcline20"> 20</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,21" id="srcline21"> 21</a></span><span class="line"><span class="comment">%   'intMatrixX' : N1xN2 matrix where the entry (i,j) is the X coordinate of the</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,22" id="srcline22"> 22</a></span><span class="line"><span class="comment">%       intersection point between line segments XY1(i,:) and XY2(j,:).</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,23" id="srcline23"> 23</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,24" id="srcline24"> 24</a></span><span class="line"><span class="comment">%   'intMatrixY' : N1xN2 matrix where the entry (i,j) is the Y coordinate of the</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,25" id="srcline25"> 25</a></span><span class="line"><span class="comment">%       intersection point between line segments XY1(i,:) and XY2(j,:).</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,26" id="srcline26"> 26</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,27" id="srcline27"> 27</a></span><span class="line"><span class="comment">%   'intNormalizedDistance1To2' : N1xN2 matrix where the (i,j) entry is the</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,28" id="srcline28"> 28</a></span><span class="line"><span class="comment">%       normalized distance from the start point of line segment XY1(i,:) to the</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,29" id="srcline29"> 29</a></span><span class="line"><span class="comment">%       intersection point with XY2(j,:).</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,30" id="srcline30"> 30</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,31" id="srcline31"> 31</a></span><span class="line"><span class="comment">%   'intNormalizedDistance2To1' : N1xN2 matrix where the (i,j) entry is the</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,32" id="srcline32"> 32</a></span><span class="line"><span class="comment">%       normalized distance from the start point of line segment XY2(j,:) to the</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,33" id="srcline33"> 33</a></span><span class="line"><span class="comment">%       intersection point with XY1(i,:).</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,34" id="srcline34"> 34</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,35" id="srcline35"> 35</a></span><span class="line"><span class="comment">%   'parAdjacencyMatrix' : N1xN2 indicator matrix where the (i,j) entry is 1 if</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,36" id="srcline36"> 36</a></span><span class="line"><span class="comment">%       line segments XY1(i,:) and XY2(j,:) are parallel.</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,37" id="srcline37"> 37</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,38" id="srcline38"> 38</a></span><span class="line"><span class="comment">%   'coincAdjacencyMatrix' : N1xN2 indicator matrix where the (i,j) entry is 1 </span></span></span>
<span class="srcline"><span class="lineno"><a href="68,39" id="srcline39"> 39</a></span><span class="line"><span class="comment">%       if line segments XY1(i,:) and XY2(j,:) are coincident.</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,40" id="srcline40"> 40</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="68,41" id="srcline41"> 41</a></span><span class="line"><span class="comment">% Version: 1.00, April 03, 2010</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,42" id="srcline42"> 42</a></span><span class="line"><span class="comment">% Version: 1.10, April 10, 2010</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,43" id="srcline43"> 43</a></span><span class="line"><span class="comment">% Author:  U. Murat Erdem</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,44" id="srcline44"> 44</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="68,45" id="srcline45"> 45</a></span><span class="line"><span class="comment">% CHANGELOG:</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,46" id="srcline46"> 46</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,47" id="srcline47"> 47</a></span><span class="line"><span class="comment">% Ver. 1.00: </span></span></span>
<span class="srcline"><span class="lineno"><a href="68,48" id="srcline48"> 48</a></span><span class="line"><span class="comment">%   -Initial release.</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,49" id="srcline49"> 49</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="68,50" id="srcline50"> 50</a></span><span class="line"><span class="comment">% Ver. 1.10:</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,51" id="srcline51"> 51</a></span><span class="line"><span class="comment">%   - Changed the input parameters. Now the function accepts two sets of line</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,52" id="srcline52"> 52</a></span><span class="line"><span class="comment">%   segments. The intersection analysis is done between these sets and not in</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,53" id="srcline53"> 53</a></span><span class="line"><span class="comment">%   the same set.</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,54" id="srcline54"> 54</a></span><span class="line"><span class="comment">%   - Changed and added fields of the output. Now the analysis provides more</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,55" id="srcline55"> 55</a></span><span class="line"><span class="comment">%   information about the intersections and line segments.</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,56" id="srcline56"> 56</a></span><span class="line"><span class="comment">%   - Performance tweaks.</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,57" id="srcline57"> 57</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="68,58" id="srcline58"> 58</a></span><span class="line"><span class="comment">% I opted not to call this 'curve intersect' because it would be misleading</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,59" id="srcline59"> 59</a></span><span class="line"><span class="comment">% unless you accept that curves are pairwise linear constructs.</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,60" id="srcline60"> 60</a></span><span class="line"><span class="comment">% I tried to put emphasis on speed by vectorizing the code as much as possible.</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,61" id="srcline61"> 61</a></span><span class="line"><span class="comment">% There should still be enough room to optimize the code but I left those out</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,62" id="srcline62"> 62</a></span><span class="line"><span class="comment">% for the sake of clarity.</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,63" id="srcline63"> 63</a></span><span class="line"><span class="comment">% The math behind is given in:</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,64" id="srcline64"> 64</a></span><span class="line"><span class="comment">%   http://local.wasp.uwa.edu.au/~pbourke/geometry/lineline2d/</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,65" id="srcline65"> 65</a></span><span class="line"><span class="comment">% If you really are interested in squeezing as much horse power as possible out</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,66" id="srcline66"> 66</a></span><span class="line"><span class="comment">% of this code I would advise to remove the argument checks and tweak the</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,67" id="srcline67"> 67</a></span><span class="line"><span class="comment">% creation of the OUT a little bit.</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,68" id="srcline68"> 68</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="68,69" id="srcline69"> 69</a></span><span class="line"><span class="comment">%%% Argument check.</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,70" id="srcline70"> 70</a></span><span class="line"><span class="comment">%-------------------------------------------------------------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,71" id="srcline71"> 71</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="68,72" id="srcline72"> 72</a></span><span class="line"><span class="comment">% validateattributes(XY1,{'numeric'},{'2d','finite'});</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,73" id="srcline73"> 73</a></span><span class="line"><span class="comment">% validateattributes(XY2,{'numeric'},{'2d','finite'});</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,74" id="srcline74"> 74</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="68,75" id="srcline75"> 75</a></span><span class="line"><span class="mxinfo " id="T6:U7">[<span class="var type1" id="S8T6U14">n_rows_1</span>,<span class="var type1" id="S9T6U15">n_cols_1</span>] = size(<span class="var type1" id="S3T71U18">XY1</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="68,76" id="srcline76"> 76</a></span><span class="line"><span class="mxinfo " id="T6:U11">[<span class="var type1" id="S11T6U22">n_rows_2</span>,<span class="var type1" id="S12T6U23">n_cols_2</span>] = size(<span class="var type1" id="S4T71U26">XY2</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="68,77" id="srcline77"> 77</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="68,78" id="srcline78"> 78</a></span><span class="line"><span class="keyword">if</span> <span class="var type1" id="S9T6U31">n_cols_1</span> ~= 4 || <span class="var type1" id="S12T6U34">n_cols_2</span> ~= 4</span></span>
<span class="srcline"><span class="lineno"><a href="68,79" id="srcline79"> 79</a></span><span class="line">    error(<span class="string">'Arguments must be a Nx4 matrices.'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="68,80" id="srcline80"> 80</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,81" id="srcline81"> 81</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="68,82" id="srcline82"> 82</a></span><span class="line"><span class="comment">%%% Prepare matrices for vectorized computation of line intersection points.</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,83" id="srcline83"> 83</a></span><span class="line"><span class="comment">%-------------------------------------------------------------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,84" id="srcline84"> 84</a></span><span class="line"><span class="mxinfo " id="T59:U17"><span class="var type1" id="S14T59U42">X1</span> = <span class="mxinfo " id="T59:U19">repmat(<span class="mxinfo " id="T63:U20"><span class="var type1" id="S3T71U46">XY1</span>(<span class="mxinfo " id="T22:U22">:</span>,<span class="mxinfo " id="T8:U23">1</span>)</span>,1,<span class="var type1" id="S11T6U50">n_rows_2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="68,85" id="srcline85"> 85</a></span><span class="line"><span class="mxinfo " id="T59:U25"><span class="var type1" id="S16T59U53">X2</span> = <span class="mxinfo " id="T59:U27">repmat(<span class="mxinfo " id="T63:U28"><span class="var type1" id="S3T71U57">XY1</span>(<span class="mxinfo " id="T22:U30">:</span>,<span class="mxinfo " id="T8:U31">3</span>)</span>,1,<span class="var type1" id="S11T6U61">n_rows_2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="68,86" id="srcline86"> 86</a></span><span class="line"><span class="mxinfo " id="T59:U33"><span class="var type1" id="S17T59U64">Y1</span> = <span class="mxinfo " id="T59:U35">repmat(<span class="mxinfo " id="T63:U36"><span class="var type1" id="S3T71U68">XY1</span>(<span class="mxinfo " id="T22:U38">:</span>,<span class="mxinfo " id="T8:U39">2</span>)</span>,1,<span class="var type1" id="S11T6U72">n_rows_2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="68,87" id="srcline87"> 87</a></span><span class="line"><span class="mxinfo " id="T59:U41"><span class="var type1" id="S18T59U75">Y2</span> = <span class="mxinfo " id="T59:U43">repmat(<span class="mxinfo " id="T63:U44"><span class="var type1" id="S3T71U79">XY1</span>(<span class="mxinfo " id="T22:U46">:</span>,<span class="mxinfo " id="T8:U47">4</span>)</span>,1,<span class="var type1" id="S11T6U83">n_rows_2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="68,88" id="srcline88"> 88</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="68,89" id="srcline89"> 89</a></span><span class="line"><span class="mxinfo " id="T72:U49"><span class="var type1" id="S4T72U86">XY2</span> = <span class="mxinfo " id="T72:U51"><span class="var type1" id="S4T71U88">XY2</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="68,90" id="srcline90"> 90</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="68,91" id="srcline91"> 91</a></span><span class="line"><span class="mxinfo " id="T59:U53"><span class="var type1" id="S19T59U91">X3</span> = <span class="mxinfo " id="T59:U55">repmat(<span class="mxinfo " id="T24:U56"><span class="var type1" id="S4T72U95">XY2</span>(<span class="mxinfo " id="T8:U58">1</span>,<span class="mxinfo " id="T22:U59">:</span>)</span>,<span class="var type1" id="S8T6U98">n_rows_1</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="68,92" id="srcline92"> 92</a></span><span class="line"><span class="mxinfo " id="T59:U61"><span class="var type1" id="S20T59U102">X4</span> = <span class="mxinfo " id="T59:U63">repmat(<span class="mxinfo " id="T24:U64"><span class="var type1" id="S4T72U106">XY2</span>(<span class="mxinfo " id="T8:U66">3</span>,<span class="mxinfo " id="T22:U67">:</span>)</span>,<span class="var type1" id="S8T6U109">n_rows_1</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="68,93" id="srcline93"> 93</a></span><span class="line"><span class="mxinfo " id="T59:U69"><span class="var type1" id="S21T59U113">Y3</span> = <span class="mxinfo " id="T59:U71">repmat(<span class="mxinfo " id="T24:U72"><span class="var type1" id="S4T72U117">XY2</span>(<span class="mxinfo " id="T8:U74">2</span>,<span class="mxinfo " id="T22:U75">:</span>)</span>,<span class="var type1" id="S8T6U120">n_rows_1</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="68,94" id="srcline94"> 94</a></span><span class="line"><span class="mxinfo " id="T59:U77"><span class="var type1" id="S22T59U124">Y4</span> = <span class="mxinfo " id="T59:U79">repmat(<span class="mxinfo " id="T24:U80"><span class="var type1" id="S4T72U128">XY2</span>(<span class="mxinfo " id="T8:U82">4</span>,<span class="mxinfo " id="T22:U83">:</span>)</span>,<span class="var type1" id="S8T6U131">n_rows_1</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="68,95" id="srcline95"> 95</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="68,96" id="srcline96"> 96</a></span><span class="line"><span class="mxinfo " id="T59:U85"><span class="var type1" id="S23T59U135">X4_X3</span> = (<span class="mxinfo " id="T59:U87"><span class="var type1" id="S20T59U138">X4</span>-<span class="var type1" id="S19T59U139">X3</span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="68,97" id="srcline97"> 97</a></span><span class="line"><span class="mxinfo " id="T59:U90"><span class="var type1" id="S24T59U142">Y1_Y3</span> = (<span class="mxinfo " id="T59:U92"><span class="var type1" id="S17T59U145">Y1</span>-<span class="var type1" id="S21T59U146">Y3</span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="68,98" id="srcline98"> 98</a></span><span class="line"><span class="mxinfo " id="T59:U95"><span class="var type1" id="S25T59U149">Y4_Y3</span> = (<span class="mxinfo " id="T59:U97"><span class="var type1" id="S22T59U152">Y4</span>-<span class="var type1" id="S21T59U153">Y3</span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="68,99" id="srcline99"> 99</a></span><span class="line"><span class="mxinfo " id="T59:U100"><span class="var type1" id="S26T59U156">X1_X3</span> = (<span class="mxinfo " id="T59:U102"><span class="var type1" id="S14T59U159">X1</span>-<span class="var type1" id="S19T59U160">X3</span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="68,100" id="srcline100">100</a></span><span class="line"><span class="mxinfo " id="T59:U105"><span class="var type1" id="S27T59U163">X2_X1</span> = (<span class="mxinfo " id="T59:U107"><span class="var type1" id="S16T59U166">X2</span>-<span class="var type1" id="S14T59U167">X1</span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="68,101" id="srcline101">101</a></span><span class="line"><span class="mxinfo " id="T59:U110"><span class="var type1" id="S28T59U170">Y2_Y1</span> = (<span class="mxinfo " id="T59:U112"><span class="var type1" id="S18T59U173">Y2</span>-<span class="var type1" id="S17T59U174">Y1</span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="68,102" id="srcline102">102</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="68,103" id="srcline103">103</a></span><span class="line"><span class="mxinfo " id="T59:U115"><span class="var type1" id="S29T59U177">numerator_a</span> = <span class="mxinfo " id="T59:U117"><span class="mxinfo " id="T59:U118"><span class="var type1" id="S23T59U180">X4_X3</span> .* <span class="var type1" id="S24T59U181">Y1_Y3</span></span> - <span class="mxinfo " id="T59:U121"><span class="var type1" id="S25T59U183">Y4_Y3</span> .* <span class="var type1" id="S26T59U184">X1_X3</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="68,104" id="srcline104">104</a></span><span class="line"><span class="mxinfo " id="T59:U124"><span class="var type1" id="S30T59U187">numerator_b</span> = <span class="mxinfo " id="T59:U126"><span class="mxinfo " id="T59:U127"><span class="var type1" id="S27T59U190">X2_X1</span> .* <span class="var type1" id="S24T59U191">Y1_Y3</span></span> - <span class="mxinfo " id="T59:U130"><span class="var type1" id="S28T59U193">Y2_Y1</span> .* <span class="var type1" id="S26T59U194">X1_X3</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="68,105" id="srcline105">105</a></span><span class="line"><span class="mxinfo " id="T59:U133"><span class="var type1" id="S31T59U197">denominator</span> = <span class="mxinfo " id="T59:U135"><span class="mxinfo " id="T59:U136"><span class="var type1" id="S25T59U200">Y4_Y3</span> .* <span class="var type1" id="S27T59U201">X2_X1</span></span> - <span class="mxinfo " id="T59:U139"><span class="var type1" id="S23T59U203">X4_X3</span> .* <span class="var type1" id="S28T59U204">Y2_Y1</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="68,106" id="srcline106">106</a></span><span class="line"><span class="mxinfo " id="T59:U142"><span class="var type1" id="S32T59U207">coOrient</span> = <span class="mxinfo " id="T59:U144">sign(<span class="mxinfo " id="T59:U145"><span class="mxinfo " id="T59:U146"><span class="var type1" id="S27T59U212">X2_X1</span> .* <span class="var type1" id="S23T59U213">X4_X3</span></span> + <span class="mxinfo " id="T59:U149"><span class="var type1" id="S28T59U215">Y2_Y1</span> .* <span class="var type1" id="S25T59U216">Y4_Y3</span></span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="68,107" id="srcline107">107</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="68,108" id="srcline108">108</a></span><span class="line"><span class="mxinfo " id="T59:U152"><span class="var type1" id="S34T59U219">u_a</span> = <span class="mxinfo " id="T59:U154"><span class="var type1" id="S29T59U221">numerator_a</span> ./ <span class="var type1" id="S31T59U222">denominator</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="68,109" id="srcline109">109</a></span><span class="line"><span class="mxinfo " id="T59:U157"><span class="var type1" id="S35T59U225">u_b</span> = <span class="mxinfo " id="T59:U159"><span class="var type1" id="S30T59U227">numerator_b</span> ./ <span class="var type1" id="S31T59U228">denominator</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="68,110" id="srcline110">110</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="68,111" id="srcline111">111</a></span><span class="line"><span class="comment">% Find the adjacency matrix A of intersecting lines.</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,112" id="srcline112">112</a></span><span class="line"><span class="comment">% INT_X = X1+X2_X1.*u_a;</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,113" id="srcline113">113</a></span><span class="line"><span class="comment">% INT_Y = Y1+Y2_Y1.*u_a;</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,114" id="srcline114">114</a></span><span class="line"><span class="mxinfo " id="T70:U162"><span class="var type1" id="S36T70U231">INT_B</span> = <span class="mxinfo " id="T70:U164"><span class="mxinfo " id="T70:U165"><span class="mxinfo " id="T70:U166">(<span class="mxinfo " id="T70:U167"><span class="var type1" id="S34T59U237">u_a</span> &gt;= <span class="mxinfo " id="T6:U169">0</span></span>) &amp; (<span class="mxinfo " id="T70:U170"><span class="var type1" id="S34T59U241">u_a</span> &lt;= <span class="mxinfo " id="T6:U172">1</span></span>)</span> &amp; (<span class="mxinfo " id="T70:U173"><span class="var type1" id="S35T59U245">u_b</span> &gt;= <span class="mxinfo " id="T6:U175">0</span></span>)</span> &amp; (<span class="mxinfo " id="T70:U176"><span class="var type1" id="S35T59U249">u_b</span> &lt;= <span class="mxinfo " id="T6:U178">1</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="68,115" id="srcline115">115</a></span><span class="line"><span class="comment">%find parallel:</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,116" id="srcline116">116</a></span><span class="line"><span class="mxinfo " id="T59:U179"><span class="var type1" id="S37T59U253">PAR_B</span> = <span class="mxinfo " id="T59:U181"><span class="var type1" id="S32T59U255">coOrient</span>.* (<span class="mxinfo " id="T70:U183"><span class="mxinfo " id="T70:U184">(<span class="mxinfo " id="T70:U185"><span class="mxinfo " id="T59:U186">abs(<span class="var type1" id="S31T59U263">denominator</span>)</span> &lt; <span class="var type1" id="S5T6U264">parThresh</span></span>) &amp;<span class="keyword">...</span><span class="comment"> <span class="comment">%near-parallel lines (based on cross-product)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="68,117" id="srcline117">117</a></span><span class="line">    (<span class="mxinfo " id="T70:U189"><span class="mxinfo " id="T59:U190">abs(<span class="mxinfo " id="T59:U191"><span class="mxinfo " id="T59:U192">(<span class="mxinfo " id="T59:U193"><span class="var type1" id="S34T59U273">u_a</span>-<span class="mxinfo " id="T6:U195">0.5</span></span>).*<span class="mxinfo " id="T59:U196"><span class="var type1" id="S7T59U276">lenMx</span>'</span></span>-<span class="mxinfo " id="T59:U198"><span class="mxinfo " id="T59:U199"><span class="var type1" id="S32T59U279">coOrient</span>.*(<span class="mxinfo " id="T59:U201"><span class="var type1" id="S35T59U282">u_b</span>-<span class="mxinfo " id="T6:U203">0.5</span></span>)</span>.*<span class="var type1" id="S7T59U284">lenMx</span></span></span>)</span>&lt;<span class="mxinfo " id="T6:U205">0.75</span></span>)</span> &amp;<span class="keyword">...</span><span class="comment"> <span class="comment">%close longitudinally</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="68,118" id="srcline118">118</a></span><span class="line">    (<span class="mxinfo " id="T70:U206"><span class="mxinfo " id="T59:U207"><span class="mxinfo " id="T59:U208">min(<span class="mxinfo " id="T59:U209">abs(<span class="mxinfo " id="T59:U210"><span class="var type1" id="S34T59U294">u_a</span>-<span class="mxinfo " id="T6:U212">0.5</span></span>)</span>,<span class="mxinfo " id="T59:U213">abs(<span class="mxinfo " id="T59:U214"><span class="var type1" id="S35T59U299">u_b</span>-<span class="mxinfo " id="T6:U216">0.5</span></span>)</span>)</span>.*<span class="mxinfo " id="T59:U217">abs(<span class="var type1" id="S31T59U303">denominator</span>)</span></span>&lt;<span class="var type1" id="S6T6U304">distThresh</span></span>)</span>)</span></span>; <span class="comment">%and transversely</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,119" id="srcline119">119</a></span><span class="line"><span class="comment">% COINC_B = (numerator_a == 0 &amp; numerator_b == 0 &amp; PAR_B);</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,120" id="srcline120">120</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="68,121" id="srcline121">121</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="68,122" id="srcline122">122</a></span><span class="line"><span class="comment">% Arrange output.</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,123" id="srcline123">123</a></span><span class="line"><span class="mxinfo " id="T70:U220"><span class="mxinfo " id="T70:U221"><span class="var type1" id="S2T69U308">out</span>.intAdjacencyMatrix</span> = <span class="var type1" id="S36T70U310">INT_B</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="68,124" id="srcline124">124</a></span><span class="line"><span class="comment">% out.intMatrixX = INT_X .* INT_B;</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,125" id="srcline125">125</a></span><span class="line"><span class="comment">% out.intMatrixY = INT_Y .* INT_B;</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,126" id="srcline126">126</a></span><span class="line"><span class="mxinfo " id="T59:U224"><span class="mxinfo " id="T59:U225"><span class="var type1" id="S2T69U314">out</span>.intNormalizedDistance1To2</span> = <span class="var type1" id="S34T59U316">u_a</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="68,127" id="srcline127">127</a></span><span class="line"><span class="mxinfo " id="T59:U228"><span class="mxinfo " id="T59:U229"><span class="var type1" id="S2T69U320">out</span>.intNormalizedDistance2To1</span> = <span class="var type1" id="S35T59U322">u_b</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="68,128" id="srcline128">128</a></span><span class="line"><span class="mxinfo " id="T59:U232"><span class="mxinfo " id="T59:U233"><span class="var type1" id="S2T69U326">out</span>.parAdjacencyMatrix</span> = <span class="var type1" id="S37T59U328">PAR_B</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="68,129" id="srcline129">129</a></span><span class="line"><span class="comment">% out.coincAdjacencyMatrix= COINC_B;</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,130" id="srcline130">130</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="68,131" id="srcline131">131</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="68,132" id="srcline132">132</a></span><span class="line"></span></span>
</pre>
</body>
</html>
